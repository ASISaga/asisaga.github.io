{% comment %}
  Team Service - Middle tier data processor for team member data
  
  This component acts as a service layer between raw team data in _data/team.yml
  and the presentation templates. It provides standardized access methods and computed properties.
  
  Parameters:
    filter_by_role: Optional parameter to filter team members by role
    
  Returns:
    A processed team object with additional computed properties.
    Access using the variable name specified in the 'assign_to' parameter.
    
  Example usage:
    {% include data-services/team-service.html 
       filter_by_role="Research" 
       assign_to="research_team" %}
    
    {% for member in research_team %}
      {{ member.name }}
    {% endfor %}
{% endcomment %}

{% assign raw_team = site.data.team.members %}

{% comment %} Apply filters if specified {% endcomment %}
{% if include.filter_by_role %}
  {% assign filtered_team = "" | split: "" %}
  {% for member in raw_team %}
    {% if member.role contains include.filter_by_role %}
      {% assign filtered_team = filtered_team | push: member %}
    {% endif %}
  {% endfor %}
  {% assign processed_team = filtered_team %}
{% else %}
  {% assign processed_team = raw_team %}
{% endif %}

{% comment %} Process each team member to add computed properties {% endcomment %}
{% assign final_team = "" | split: "" %}
{% for member in processed_team %}
  {% assign processed_member = member %}
  
  {% comment %} Add computed fields {% endcomment %}
  {% assign has_linkedin = false %}
  {% if member.linkedin %}
    {% assign has_linkedin = true %}
  {% endif %}
  
  {% assign has_image = false %}
  {% if member.image %}
    {% assign has_image = true %}
  {% endif %}
  
  {% comment %} Create image path if image exists {% endcomment %}
  {% assign image_path = "" %}
  {% if has_image %}
    {% assign image_path = "/assets/images/team/" | append: member.image | relative_url %}
  {% endif %}
  
  {% comment %} Create LinkedIn URL if username exists {% endcomment %}
  {% assign linkedin_url = "" %}
  {% if has_linkedin %}
    {% assign linkedin_url = "https://www.linkedin.com/in/" | append: member.linkedin %}
  {% endif %}
  
  {% comment %} Add computed fields to member {% endcomment %}
  {% assign processed_member.computed_has_linkedin = has_linkedin %}
  {% assign processed_member.computed_has_image = has_image %}
  {% assign processed_member.computed_image_path = image_path %}
  {% assign processed_member.computed_linkedin_url = linkedin_url %}
  
  {% assign final_team = final_team | push: processed_member %}
{% endfor %}

{% comment %} Assign the processed team to the variable name specified {% endcomment %}
{% if include.assign_to %}
  {% assign variable_name = include.assign_to %}
  {% capture outer_scope %}{{ variable_name }} = final_team{% endcapture %}
  {% capture _ %}{{ outer_scope }}{% endcapture %}
{% endif %}
